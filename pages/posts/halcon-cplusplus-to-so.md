---
title: ã€Halconã€‘Halconè”åˆC/C++åŠæ‰“åŒ…SOåº“
date: 2021-08-13 15:49:00
tags: [halcon, .so, C/C++]
categories: 
  - ç‰›æ’çš„å°æ•™ç¨‹
---

## å‰è¨€

ä¸ºäº†å°†halconç¼–å†™çš„ç®—æ³•ç”¨åœ¨WEBç«¯çš„äº§å“ï¼Œéœ€è¦å¯¼å‡ºä¸ºC++ä»£ç ï¼Œå¹¶åœ¨Linuxæ‰“åŒ…æˆSOåº“ï¼Œæœ€ç»ˆç”±JAVAçš„JNAè°ƒç”¨......åœ¨æŠ˜è…¾äº†ä¸€å¤©åè§£å†³è¿â€œé«˜çº§JAVAå·¥ç¨‹å¸ˆâ€éƒ½æ— æ³•è§£å†³çš„é—®é¢˜äº†â†˜å‘¢â†’

> æˆ‘ ä»¬ è” åˆ ï¼

<!-- more -->

## æ­£æ–‡

> å…ˆæ”¾å‚è€ƒé“¾æ¥ï¼Œå› ä¸ºä¹‹å‰æ²¡æ‰“åŒ…ï¼Œæ€è·¯ä¹Ÿå¤§å¤šæ—¶ä»ç½‘ä¸Šæ‰¾çš„ï¼š
>
> ã€1ã€‘[è¶…è¯¦ç»†ï¼šhalcon ä¸ VS è”åˆç¼–ç¨‹æ•™ç¨‹ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/99772880)
> ã€2ã€‘[ä½¿ç”¨VSç”Ÿæˆæœ¬åœ°é™æ€åº“æ–‡ä»¶ä»¥åŠé™æ€åº“æ–‡ä»¶çš„ä½¿ç”¨_WHEgqingçš„ä¸“æ -CSDNåšå®¢](https://blog.csdn.net/WHEgqing/article/details/103680568)
> ã€3ã€‘[Ubuntu18.04+Halcon18.11å®‰è£…æ•™ç¨‹](https://blog.csdn.net/liubing8609/article/details/88046250)
> ã€4ã€‘[linuxä¸‹javaè°ƒç”¨.soåŠ¨æ€åº“æ–¹æ³•](https://blog.csdn.net/qq_34106574/article/details/85627333)

æ–‡ç« ä»¥æ–‡å­—ä¸ºä¸»ï¼ˆä¸»è¦æ˜¯è´´å›¾å¤ªéº»çƒ¦ï¼‰ï¼Œæˆ‘å°½é‡æŠŠæ“ä½œæ­¥éª¤å†™æ˜ç™½ï¼›

ç”¨æ¥ç¤ºèŒƒçš„ç®—æ³•æ˜¯ **äºŒç»´ç è¯†åˆ«**ï¼Œhalconä»£ç å¦‚ä¸‹ï¼š

```
* mainæ–‡ä»¶
action ('123.png', result)

------åˆ†å‰²çº¿------

* action(::path:result)
read_image (Image, path)
**è¾“å…¥å›¾åƒ
**è¾“å‡ºäºŒç»´ç çš„ç»“æœ
get_2dcode_result (Image, DecodedDataStrings)
result := DecodedDataStrings
return ()

------åˆ†å‰²çº¿------

* get_2dcode_result(tdcode:::DecodedDataStrings)

* *è¾“å…¥äºŒç»´ç åŒºåŸŸçš„å›¾åƒå˜é‡Image
* *è¾“å‡ºäºŒç»´ç çš„ç»“æœ
* **äºŒç»´ç è¯†åˆ«éœ€è¦ä½¿ç”¨åŸå›¾   å¤šæ¢å‡ ä¸ªå‚æ•°æ¥è¯†åˆ«ã€‚

create_data_code_2d_model ('QR Code', 'default_parameters', 'enhanced_recognition', DataCodeHandleQR)

set_data_code_2d_param (DataCodeHandleQR, 'default_parameters', 'enhanced_recognition')
set_data_code_2d_param (DataCodeHandleQR, 'timeout', 200)
set_data_code_2d_param (DataCodeHandleQR, 'polarity', 'dark_on_light')

* ç ç²’ä¸ªæ•°è®¾ç½®(æœ‰å‡ ç§äºŒç»´ç è®¾ç½®è¿™ä¸ªå‚æ•°éæ³•)
* set_data_code_2d_param (DataCodeHandleQR, 'symbol_size_max', 11)
* set_data_code_2d_param (DataCodeHandleQR, 'symbol_size_max', 31)

* å¢å¼ºå›¾åƒå¯¹æ¯”åº¦ï¼ˆåæ–‡æœ‰è¯¥å‡½æ•°è¯´æ˜ï¼‰
* enhanced_contrast (ImagePart, Image2, 40, 180)
Max := 254
Min := 1

Mult := 255.0 / (Max - Min)

Add := -Mult * Min
scale_image (tdcode, Image2, Mult, Add)


* ç ç²’åƒç´ è®¾ç½®
set_data_code_2d_param (DataCodeHandleQR, ['module_size_min','module_size_max'], [1,40])

* å¦‚æœGenParamNames, GenParamValuesä¸å¡«ï¼Œé‚£ä¹ˆé»˜è®¤åªæ‰¾ä¸€ä¸ªäºŒç»´ç ï¼Œå°†'stop_after_result_num'è®¾ç½®ä¸º3æŒ‡æœ€å¤šæ‰¾3ä¸ª
find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, [], [], ResultHandles, DecodedDataStrings)
find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, 'stop_after_result_num', 3, ResultHandles, DecodedDataStrings)

tuple_length (DecodedDataStrings, Length)

* æ‰¾ä¸åˆ°çš„è¯ï¼Œæ”¹ä¸€ä¸‹å‚æ•°å†æ‰¾ä¸€é
if (Length == 0)
    set_data_code_2d_param (DataCodeHandleQR, ['module_size_min','module_size_max'], [1,40])
    find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, [], [], ResultHandles, DecodedDataStrings)
endif

tuple_length (DecodedDataStrings, Length)

if (Length=0)
    Max := 180
    Min := 80

    Mult := 255.0 / (Max - Min)
    Add := -Mult * Min

    scale_image (tdcode, Image2, Mult, Add)

    * ç ç²’åƒç´ è®¾ç½®
    set_data_code_2d_param (DataCodeHandleQR, ['module_size_min','module_size_max'], [1,40])

    * å¦‚æœGenParamNames, GenParamValuesä¸å¡«ï¼Œé‚£ä¹ˆé»˜è®¤åªæ‰¾ä¸€ä¸ªäºŒç»´ç ï¼Œå°†'stop_after_result_num'è®¾ç½®ä¸º3æŒ‡æœ€å¤šæ‰¾3ä¸ª
    find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, [], [], ResultHandles, DecodedDataStrings)
    find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, 'stop_after_result_num', 3, ResultHandles, DecodedDataStrings)

    tuple_length (DecodedDataStrings, Length)

    * æ‰¾ä¸åˆ°çš„è¯ï¼Œæ”¹ä¸€ä¸‹å‚æ•°å†æ‰¾ä¸€é
    if (Length == 0)
        set_data_code_2d_param (DataCodeHandleQR, ['module_size_min','module_size_max'], [1,40])
        find_data_code_2d (Image2, SymbolXLDs, DataCodeHandleQR, [], [], ResultHandles, DecodedDataStrings)
    endif

    tuple_length (DecodedDataStrings, Length)

    if (Length == 0)
        DecodedDataStrings := ''
    endif

endif
return ()
```

ä»ä»£ç ä¸éš¾çœ‹å‡ºï¼Œç¨‹åºæ˜¯é€šè¿‡è°ƒç”¨`action()` æ¥å¾—åˆ°äºŒç»´ç è¯†åˆ«ç»“æœçš„ï¼Œæ ¹æ®çƒ­å¿ƒç½‘å‹æé†’å¯èƒ½å‘ç”Ÿçš„ABIé”™è¯¯ï¼Œå‡½æ•°å£°æ˜æ—¶è¦æ·»åŠ  **extern** å…³é”®å­—ï¼ŒåŒæ—¶ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæ–‡ä»¶åé‡‡ç”¨ç»å¯¹è·¯å¾„çš„å½¢å¼ï¼š

```cpp
///////////////////////////////////////////////////////////////////////////////
// File generated by HDevelop for HALCON/C++ Version 20.11.1.2
// Non-ASCII strings in this file are encoded in UTF-8.
// 
// Please note that non-ASCII characters in string constants are exported
// as octal codes in order to guarantee that the strings are correctly
// created on all systems, independent on any compiler settings.
// 
// Source files with different encoding should not be mixed in one project.
///////////////////////////////////////////////////////////////////////////////



#ifndef __APPLE__
#  include "HalconCpp.h"
#  include "HDevThread.h"
#else
#  ifndef HC_LARGE_IMAGES
#    include <HALCONCpp/HalconCpp.h>
#    include <HALCONCpp/HDevThread.h>
#    include <HALCON/HpThread.h>
#  else
#    include <HALCONCppxl/HalconCpp.h>
#    include <HALCONCppxl/HDevThread.h>
#    include <HALCONxl/HpThread.h>
#  endif
#  include <stdio.h>
#  include <CoreFoundation/CFRunLoop.h>
#endif

using namespace HalconCpp;

extern "C"
{
    // Procedure declarations 
    // Local procedures 
    void action(HTuple hv_path, HTuple* hv_result);
    void get_2dcode_result(HObject ho_tdcode, HTuple* hv_DecodedDataStrings);
}

// Procedures 
// Local procedures 
void action(HTuple hv_path, HTuple* hv_result)
{

    // Local iconic variables
    HObject  ho_Image;

    // Local control variables
    HTuple  hv_DecodedDataStrings;

    ReadImage(&ho_Image, hv_path);

    //*è¾“å…¥å›¾åƒ
    //*è¾“å‡ºäºŒç»´ç çš„ç»“æœ
    get_2dcode_result(ho_Image, &hv_DecodedDataStrings);
    //zoom_image_factor (Image, ImageZoomed, 2, 2, 'constant')

    //get_2dcode_result (ImageZoomed, DecodedDataStrings2)
    //zoom_image_factor (Image, ImageZoomed, 2, 2, 'constant')
    //write_image (ImageZoomed, 'jpg', 0, '19.jpg')


    (*hv_result) = hv_DecodedDataStrings;

    return;
}

void get_2dcode_result(HObject ho_tdcode, HTuple* hv_DecodedDataStrings)
{

    // Local iconic variables
    HObject  ho_Image2, ho_SymbolXLDs;

    // Local control variables
    HTuple  hv_DataCodeHandleQR, hv_Max, hv_Min, hv_Mult;
    HTuple  hv_Add, hv_ResultHandles, hv_Length;


    //*è¾“å…¥äºŒç»´ç åŒºåŸŸçš„å›¾åƒå˜é‡Image
    //*è¾“å‡ºäºŒç»´ç çš„ç»“æœ
    //stop ()
    //**äºŒç»´ç è¯†åˆ«éœ€è¦ä½¿ç”¨åŸå›¾   å¤šæ¢å‡ ä¸ªå‚æ•°æ¥è¯†åˆ«ã€‚

    CreateDataCode2dModel("QR Code", "default_parameters", "enhanced_recognition",
        &hv_DataCodeHandleQR);

    SetDataCode2dParam(hv_DataCodeHandleQR, "default_parameters", "enhanced_recognition");
    SetDataCode2dParam(hv_DataCodeHandleQR, "timeout", 200);
    SetDataCode2dParam(hv_DataCodeHandleQR, "polarity", "dark_on_light");

    //ç ç²’ä¸ªæ•°è®¾ç½®(æœ‰å‡ ç§äºŒç»´ç è®¾ç½®è¿™ä¸ªå‚æ•°éæ³•)
    //set_data_code_2d_param (DataCodeHandleQR, 'symbol_size_max', 11)
    //set_data_code_2d_param (DataCodeHandleQR, 'symbol_size_max', 31)

    //å¢å¼ºå›¾åƒå¯¹æ¯”åº¦ï¼ˆåæ–‡æœ‰è¯¥å‡½æ•°è¯´æ˜ï¼‰
    //enhanced_contrast (ImagePart, Image2, 40, 180)
    hv_Max = 254;
    hv_Min = 1;

    hv_Mult = 255.0 / (hv_Max - hv_Min);

    hv_Add = (-hv_Mult) * hv_Min;
    ScaleImage(ho_tdcode, &ho_Image2, hv_Mult, hv_Add);


    //ç ç²’åƒç´ è®¾ç½®
    SetDataCode2dParam(hv_DataCodeHandleQR, (HTuple("module_size_min").Append("module_size_max")),
        (HTuple(1).Append(40)));

    //å¦‚æœGenParamNames, GenParamValuesä¸å¡«ï¼Œé‚£ä¹ˆé»˜è®¤åªæ‰¾ä¸€ä¸ªäºŒç»´ç ï¼Œå°†'stop_after_result_num'è®¾ç½®ä¸º3æŒ‡æœ€å¤šæ‰¾3ä¸ª
    FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, HTuple(), HTuple(),
        &hv_ResultHandles, &(*hv_DecodedDataStrings));
    FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, "stop_after_result_num",
        3, &hv_ResultHandles, &(*hv_DecodedDataStrings));

    TupleLength((*hv_DecodedDataStrings), &hv_Length);

    //æ‰¾ä¸åˆ°çš„è¯ï¼Œæ”¹ä¸€ä¸‹å‚æ•°å†æ‰¾ä¸€é
    if (0 != (int(hv_Length == 0)))
    {
        SetDataCode2dParam(hv_DataCodeHandleQR, (HTuple("module_size_min").Append("module_size_max")),
            (HTuple(1).Append(40)));
        FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, HTuple(), HTuple(),
            &hv_ResultHandles, &(*hv_DecodedDataStrings));
    }

    TupleLength((*hv_DecodedDataStrings), &hv_Length);

    if (0 != (int(hv_Length == 0)))
    {
        hv_Max = 180;
        hv_Min = 80;

        hv_Mult = 255.0 / (hv_Max - hv_Min);
        hv_Add = (-hv_Mult) * hv_Min;

        ScaleImage(ho_tdcode, &ho_Image2, hv_Mult, hv_Add);

        //ç ç²’åƒç´ è®¾ç½®
        SetDataCode2dParam(hv_DataCodeHandleQR, (HTuple("module_size_min").Append("module_size_max")),
            (HTuple(1).Append(40)));

        //å¦‚æœGenParamNames, GenParamValuesä¸å¡«ï¼Œé‚£ä¹ˆé»˜è®¤åªæ‰¾ä¸€ä¸ªäºŒç»´ç ï¼Œå°†'stop_after_result_num'è®¾ç½®ä¸º3æŒ‡æœ€å¤šæ‰¾3ä¸ª
        FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, HTuple(), HTuple(),
            &hv_ResultHandles, &(*hv_DecodedDataStrings));
        FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, "stop_after_result_num",
            3, &hv_ResultHandles, &(*hv_DecodedDataStrings));

        TupleLength((*hv_DecodedDataStrings), &hv_Length);

        //æ‰¾ä¸åˆ°çš„è¯ï¼Œæ”¹ä¸€ä¸‹å‚æ•°å†æ‰¾ä¸€é
        if (0 != (int(hv_Length == 0)))
        {
            SetDataCode2dParam(hv_DataCodeHandleQR, (HTuple("module_size_min").Append("module_size_max")),
                (HTuple(1).Append(40)));
            FindDataCode2d(ho_Image2, &ho_SymbolXLDs, hv_DataCodeHandleQR, HTuple(), HTuple(),
                &hv_ResultHandles, &(*hv_DecodedDataStrings));
        }

        TupleLength((*hv_DecodedDataStrings), &hv_Length);

        if (0 != (int(hv_Length == 0)))
        {
            (*hv_DecodedDataStrings) = "";
        }
    }
    return;
}

#ifndef NO_EXPORT_MAIN
// Main procedure 
void action()
{

    // Local control variables
    HTuple  hv_result;

    action("/home/sknp/Documents/JProject/diaoso/src/123.png", &hv_result);

    std::cout << hv_result << std::endl;
}


#ifndef NO_EXPORT_APP_MAIN

#ifdef __APPLE__
// On OS X systems, we must have a CFRunLoop running on the main thread in
// order for the HALCON graphics operators to work correctly, and run the
// action function in a separate thread. A CFRunLoopTimer is used to make sure
// the action function is not called before the CFRunLoop is running.
// Note that starting with macOS 10.12, the run loop may be stopped when a
// window is closed, so we need to put the call to CFRunLoopRun() into a loop
// of its own.
HTuple      gStartMutex;
H_pthread_t gActionThread;
HBOOL       gTerminate = FALSE;

static void timer_callback(CFRunLoopTimerRef timer, void* info)
{
    UnlockMutex(gStartMutex);
}

static Herror apple_action(void** parameters)
{
    // Wait until the timer has fired to start processing.
    LockMutex(gStartMutex);
    UnlockMutex(gStartMutex);

    try
    {
        action();
    }
    catch (HException& exception)
    {
        fprintf(stderr, "  Error #%u in %s: %s\n", exception.ErrorCode(),
            exception.ProcName().TextA(),
            exception.ErrorMessage().TextA());
    }

    // Tell the main thread to terminate itself.
    LockMutex(gStartMutex);
    gTerminate = TRUE;
    UnlockMutex(gStartMutex);
    CFRunLoopStop(CFRunLoopGetMain());
    return H_MSG_OK;
}

static int apple_main(int argc, char* argv[])
{
    Herror                error;
    CFRunLoopTimerRef     Timer;
    CFRunLoopTimerContext TimerContext = { 0, 0, 0, 0, 0 };

    CreateMutex("type", "sleep", &gStartMutex);
    LockMutex(gStartMutex);

    error = HpThreadHandleAlloc(&gActionThread);
    if (H_MSG_OK != error)
    {
        fprintf(stderr, "HpThreadHandleAlloc failed: %d\n", error);
        exit(1);
    }

    error = HpThreadCreate(gActionThread, 0, apple_action);
    if (H_MSG_OK != error)
    {
        fprintf(stderr, "HpThreadCreate failed: %d\n", error);
        exit(1);
    }

    Timer = CFRunLoopTimerCreate(kCFAllocatorDefault,
        CFAbsoluteTimeGetCurrent(), 0, 0, 0,
        timer_callback, &TimerContext);
    if (!Timer)
    {
        fprintf(stderr, "CFRunLoopTimerCreate failed\n");
        exit(1);
    }
    CFRunLoopAddTimer(CFRunLoopGetCurrent(), Timer, kCFRunLoopCommonModes);

    for (;;)
    {
        HBOOL terminate;

        CFRunLoopRun();

        LockMutex(gStartMutex);
        terminate = gTerminate;
        UnlockMutex(gStartMutex);

        if (terminate)
            break;
    }

    CFRunLoopRemoveTimer(CFRunLoopGetCurrent(), Timer, kCFRunLoopCommonModes);
    CFRelease(Timer);

    error = HpThreadHandleFree(gActionThread);
    if (H_MSG_OK != error)
    {
        fprintf(stderr, "HpThreadHandleFree failed: %d\n", error);
        exit(1);
    }

    ClearMutex(gStartMutex);
    return 0;
}
#endif

int main(int argc, char* argv[])
{
    int ret = 0;

    try
    {
#if defined(_WIN32)
        SetSystem("use_window_thread", "true");
#endif

        // Default settings used in HDevelop (can be omitted)
        SetSystem("width", 512);
        SetSystem("height", 512);

#ifndef __APPLE__
        action();
        std::getchar();
#else
        ret = apple_main(argc, argv);
#endif
    }
    catch (HException& exception)
    {
        fprintf(stderr, "  Error #%u in %s: %s\n", exception.ErrorCode(),
            exception.ProcName().TextA(),
            exception.ErrorMessage().TextA());
        ret = 1;
    }
    return ret;
}
#endif
#endif
```

> **P.S.  halconåœ¨linuxä¸windowså¯¼å‡ºçš„è¯­è¨€æ–‡ä»¶å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯åœ¨ä¸åŒå¹³å°ç¼–è¯‘çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œåæ–‡ç»†å—¦ï¼› **

### åœ¨windowsä¸‹ç¼–è¯‘

> è¯¦æƒ…åœ¨å‚è€ƒé“¾æ¥ã€1ã€‘ä¸­ï¼Œå®Œå…¨æŒ‰ç…§å‚è€ƒæ•™ç¨‹å³å¯ï¼›

ä½¿ç”¨Visual Studioç¼–è¯‘é¡¹ç›®ï¼š

- é¡¹ç›® **å±æ€§é¡µ**
  - **VC++ç›®å½•** --> **åŒ…å«ç›®å½•** ï¼š%halconå®‰è£…ç›®å½•%/include
  - **VC++ç›®å½•** --> **åº“ç›®å½•** ï¼š%halconå®‰è£…ç›®å½•%/lib/x64-win64
  - **é“¾æ¥å™¨** --> **é™„åŠ ä¾èµ–é¡¹** ï¼šæ‰‹åŠ¨è¾“å…¥ **halconcpp.lib** ï¼ˆcppé¡¹ç›®ä¾èµ–çš„åº“æ–‡ä»¶ï¼‰

> åœ¨æˆ‘ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†éè¯­æ³•é—®é¢˜ï¼Œæ¥å›å€’è…¾äº†å‡ æ¬¡è«åå…¶å¦™å°±å¥½äº†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒé—®é¢˜ä¸å¦¨ç•™è¨€è®¨è®ºï¼›

### åœ¨linuxä¸‹ç¼–è¯‘

æ¥ä¸‹æ¥æ˜¯å›°æ‰°æˆ‘å¾ˆé•¿æ—¶é—´çš„é—®é¢˜ï¼Œä¸Šé¢è¯´åˆ°åœ¨windowsä¸‹ç¼–è¯‘éœ€è¦ **include** ï¼ˆä¸€ç³»åˆ—å¤´æ–‡ä»¶ï¼‰å’Œ **.lib** æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨linuxä¸‹æ˜¾ç„¶æ²¡æœ‰libæ–‡ä»¶å¯ç”¨ï¼›åœ¨æ‰¾äº†å¤§é‡èµ„æ–™åï¼Œæˆ‘æ‚Ÿäº†ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼šå¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶æ˜¯ä¸€èµ·çš„ï¼Œå¤´æ–‡ä»¶æ˜¯å£°æ˜åº“æ–‡ä»¶å‡½æ•°çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨linuxä¸‹æ‰¾åˆ°å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶å°±èƒ½ç¼–è¯‘ï¼Œè¿™é‡Œçš„åº“æ–‡ä»¶ä¹Ÿå°±æ˜¯SOåº“ï¼



å¥½çš„ï¼Œæ€è·¯å·²ç»æœ‰äº†ï¼Œå¼€å§‹å®æ“~

é¦–å…ˆè¦åœ¨linuxç¯å¢ƒä¸‹å®‰è£…halconï¼Œå‚è€ƒé“¾æ¥ã€3ã€‘å¯ä»¥é¡ºåˆ©çš„å®‰è£…ï¼Œæˆ‘é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯ **halcon 20.11.1** ï¼›

é…ç½®å¥½åï¼Œç»ˆç«¯è¿è¡Œï¼š

```bash
echo $LD_LIBRARY_PATH
```

æ˜¾ç¤ºç»“æœï¼š`/opt/halcon/lib/x64-linux` ä»£è¡¨å®‰è£…æˆåŠŸï¼Œè®°ä½è¿™ä¸ªè·¯å¾„ï¼Œé‡Œé¢çš„æ–‡ä»¶æœ‰å¤§ç”¨ï¼›



å¼€å§‹ç¼–è¯‘ï¼Œä¾æ¬¡è¾“å…¥ä¸¤æ¡å‘½ä»¤ï¼š

```bash
clang++ -c qr.cpp -I include/ -I include/halconcpp/ -fPIC
clang++ -shared -fPIC qrcode.o -o libqrcode.so -lhalcon -lhalconcpp
```

> ç®€å•è¯´è¯´å‚æ•°ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘æŠŠ **include** æ–‡ä»¶å¤¹å¤åˆ¶åˆ°qr.cppçš„åŒç›®å½•ï¼Œä½¿ç”¨`-I` å¼•å…¥ä¸Šè¿°è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©è·¯å¾„ï¼›
>
> `-l` å‘½ä»¤éœ€è¦è¾“å…¥SOæ–‡ä»¶çš„libxxxx.soçš„ä¸­é—´éƒ¨åˆ†ï¼Œè¿™é‡Œç”¨åˆ°äº† **libhalcon.so** å’Œ **libhalconcpp.so**

è¿˜æœ‰æ®µæ’æ›²å•Šï¼Œåœ¨æˆ‘æ²¡å®‰è£…halconå‰ï¼Œ`-l` é»˜è®¤ä¼šåœ¨ `/usr/lib` ä¸­å¯»æ‰¾ï¼›å¥½ï¼Œé‚£æˆ‘æŠŠSOæ–‡ä»¶å¤åˆ¶åˆ°ç›®å½•ä¸‹å†å¼•å…¥ï¼Œä½†ï¼æ˜¯ï¼æºæ–‡ä»¶å…¨åæ˜¯ `libhalcon.so.20.11.1` å’Œ `libhalconcpp.so.20.11.1` ï¼Œå¸¦åç¼€çš„SOåº“ä¸èƒ½è¢«ç¼–è¯‘å™¨æ‰¾åˆ°ï¼ˆè¶…å‘ï¼ï¼‰äºæ˜¯ä½¿ç”¨è½¯è¿æ¥ï¼š

```bash
ln -s libhalcon.so.20.11.1 libhalcon.so
ln -s libhalconcpp.so.20.11.1 libhalconcpp.so
```

ä¸ªäººå»ºè®®å®‰è£…halconï¼Œä»¥é˜²ç¼ºè¿™ç¼ºé‚£çš„ï¼›

å†çœ‹çœ‹æ‰“åŒ…çš„ `libqrcode.so` æœ‰æ²¡æœ‰æ­£ç¡®å¼•ç”¨ï¼š

```bash
sknp@ubuntu:~/Documents/JProject/diaoso/src$ ldd libqrcode.so 
	linux-vdso.so.1 (0x00007ffcba34d000)
	libhalcon.so.20.11.1 => /opt/halcon/lib/x64-linux/libhalcon.so.20.11.1 (0x00007fd3ee12a000)
	libhalconcpp.so.20.11.1 => /opt/halcon/lib/x64-linux/libhalconcpp.so.20.11.1 (0x00007fd3edb65000)
	libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fd3ed971000)
	libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fd3ed822000)
	libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fd3ed807000)
	libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd3ed615000)
	libX11.so.6 => /lib/x86_64-linux-gnu/libX11.so.6 (0x00007fd3ed4d6000)
	libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd3ed4b3000)
	librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd3ed4a8000)
	libXext.so.6 => /lib/x86_64-linux-gnu/libXext.so.6 (0x00007fd3ed493000)
	libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd3ed48d000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fd3f2693000)
	libxcb.so.1 => /lib/x86_64-linux-gnu/libxcb.so.1 (0x00007fd3ed461000)
	libXau.so.6 => /lib/x86_64-linux-gnu/libXau.so.6 (0x00007fd3ed45b000)
	libXdmcp.so.6 => /lib/x86_64-linux-gnu/libXdmcp.so.6 (0x00007fd3ed453000)
	libbsd.so.0 => /lib/x86_64-linux-gnu/libbsd.so.0 (0x00007fd3ed439000)
```

ä¸»è¦çœ‹è¿™ä¸¤æ¡ï¼š

- libhalcon.so.20.11.1 => /opt/halcon/lib/x64-linux/libhalcon.so.20.11.1 (0x00007fd3ee12a000)
- libhalconcpp.so.20.11.1 => /opt/halcon/lib/x64-linux/libhalconcpp.so.20.11.1 (0x00007fd3edb65000)

OKKä¸‹ä¸€æ­¥ï¼›

### JNAè°ƒç”¨SOåº“

å¥½å®¶ä¼™ï¼Œä»halconè”åˆC#åˆ°JAVAè°ƒSOï¼ŒæŠŠC#ã€C++ã€JAVAæŠ˜è…¾ä¸ªéï¼›

è°ƒç”¨æ–¹å¼å‚è€ƒé“¾æ¥ã€4ã€‘ï¼ŒJAVAé¡¹ç›®çš„é…ç½®å°±ä¸å¤šè¯´äº†ï¼Œä¸Šä»£ç ï¼š

```java
import com.sun.jna.Library;
import com.sun.jna.Native;

public class Jtest {

    // ç»§æ‰¿Libraryï¼Œç”¨äºåŠ è½½åº“æ–‡ä»¶
    public interface Clibrary extends Library {
        // åŠ è½½libhello.soé“¾æ¥åº“
        Clibrary INSTANTCE = (Clibrary) Native.loadLibrary("qrcode",
                Clibrary.class);
        // æ­¤æ–¹æ³•ä¸ºé“¾æ¥åº“ä¸­çš„æ–¹æ³•
        int main();
    }

    public static void main(String[] args) {
        // è°ƒç”¨
        Clibrary.INSTANTCE.main();
    }
}
```

## æœ€å

è¸©å‘å²ï¼š

- åœ¨ç¼–è¯‘çš„æ—¶å€™æç¤ºundefine symbolé”™è¯¯ï¼Œä¸æ˜æ‰€ä»¥ï¼Œåæ¥åœ¨windowså¹³å°ç¼–è¯‘åæ‰å‘ç°ç¼ºå°‘halconcppæ–‡ä»¶ï¼ˆå·¨å‘ï¼Œä¸€å¼€å§‹çš„æ–¹å‘ä¾¿æ˜¯é”™çš„ï¼‰ï¼›

- è‹¥ä¸æ˜¯ä¹‹å‰ç½‘å‹æé†’åŠ ä¸Š **extern "C"** ï¼Œææ€•ä¼šæ›´è´¹åŠ²ï¼›

æ€»çš„æ¥è¯´ï¼ŒèŠ±äº†ä¸€å¤©æ—¶é—´è§£å†³äº†â€œJAVAå·¥ç¨‹å¸ˆâ€å‡ å¤©éƒ½æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¿˜æ˜¯æœ‰ç‚¹å°æˆå°±æ„Ÿçš„ï¼ˆ

ç»è¿‡äº†è¿™ä¸€å¤©ï¼Œæˆ‘æ¡èµ·äº†è®¸ä¹…æœªç”¨çš„C/C++å’ŒJAVAï¼Œæœç€å…¨å¹²å·¥ç¨‹å¸ˆæ›´è¿‘äº†ä¸€æ­¥ğŸ˜‚

éšåå‡èŒåŠ è–ªã€è¿å¨¶ç™½å¯Œç¾ï¼Œèµ°ä¸Šäººç”Ÿå·…å³°...
